---
title: "リーダブルコード7章感想"
date: 2022-07-28
categories: ["本まとめ"]
tags: ["リーダブルコード"]
---

## 7章: 制御フローを読みやすくする

今回の記事からは、単なるまとめではなく、自分が大事だと思った部分や議論の余地があると思った部分を取り上げていくようにします。

ここまでの命名やコメントなど処理ではない部分の解説とはうってかわって、処理をどう書くのがわかりやすいか、という話題に入りました。

キーワードは、

> 条件やループなどの制御フローはできるだけ「自然」にする。コードの読み手が立ち止まったり読み返したりしないように書く。

ということです。

### 条件文の書き方
ifなどの条件文で、`if (length <= 10)`と`if (10 >= length)`のどっちがいいんだという話です。

筆者の主張は、「調べる対象は左、比較対象を右」というルールです。

`if (length <= 10)`や、`if (length <= max_length)`のような感じですね。

ところで私は、`if (length >= 0)`は`if (0 <= length)`に変えたくなってしまいます。

なぜかというと、数直線的に左が小さい数、右が大きい数というイメージがあるからです。

比較対象が小さいなら左に`if (0 <= length)`  
比較対象が大きいなら右に`if (length <= 10)`としたくなります。

なお、何人か他のプログラマーに聞いて見ましたが、比較対象が常に右にある方が読みやすいという人が多数派でした……。

別の意見として、`==`の時は比較対象を左にすべきというものがありました。`if (0 == length)`

これは、`if (length == 0)`とすると`if (length = 0)`と書き間違えて正常に動作しないリスクが高いからです。

私の触ったことのあるSwiftやPythonではこの表記はアラートを表示してくれるので、考えたこともありませんでした。

エラーにならない言語があるようなので、この表記を習慣付けておくことでミスを減らすことができる方法なのだと思います。

余談ですが、私は最初に触れたPythonで`if 0 < x < 10:`と書いて普通にできてしまったのでどの言語でもできる方法なのだと思っていました。

一般的にはできず`if (0 < x && x < 10)`などと書く必要があるようで。


### do/whileは使わない方が良い

do/whileは使ったことがありませんでした。

とりあえずdoをやって、whileの条件に当てはまるかぎりdoを再実行するやつと理解しています。

こいつが問題なのは、doを読んだ後にwhileの条件を読むとまた戻ってdoの中身を確認する必要があることです。

whileに書き換えて、条件文が最初にある形のほうが読みやすいコードになります。

主張には納得しているのですが、正直私には例示されていたプログラムがどうやってdo/whileをwhileに変換しているのか処理が理解できませんでした……。

### returnで早く関数から返してもOK

ガード節を使って関数から抜ける処理を書くと流れがシンプルになるという話です。

ガード節はSwiftでよく`guard let self = self else { return }`とかやっているので馴染み深いです。

これは、selfがnullだったらreturnで関数から抜けていて、nullじゃない場合は値をselfに入れて続行みたいな処理です。

### gotoは良くない

`goto`はあまり使ったことがありませんが、コードの好きな場所に飛べるコマンドです。

使うと処理順番がメチャメチャになるので、`exit:`のような最下部に飛ぶような`goto`以外は使わない方が良いという話です。

### ネストは浅くした方がいい

ネストが深くなって読みにくくなることがよくあるので役に立ちました。

ネストを浅くするには、
* `return`を使って早めに関数を抜ける
* `continue`を使って早めにループを抜ける

### 処理の実行を追えるのが大事

処理の実行をコードを上から下に読むだけで終えるのが大事です。

以下のようなものを使うと処理を追いづらくなるようですが、スレッド以外あまりピンとこない言葉でした。
* スレッド
* シグナル/割り込みハンドラ
* 例外
* 関数ポインタと無名関数
* 仮想メソッド 

以上！