---
title: "オブジェクト指向でなぜ作るのか5章感想"
date: 2022-09-30
categories: ["本まとめ"]
tags: ["オブジェクト指向でなぜ作るのか", "swift"]
---

この記事では、SwiftでiOSアプリのプログラミングをする初学者として、

「オブジェクト指向でなぜつくるのか 第3版 知っておきたいOOP、設計、アジャイル開発の基礎知識」

https://www.amazon.co.jp/dp/4296000187

の感想、学びになった点を書いていきます。

## 実行方式について
### コンパイラ方式
機械語に変換してから実行。

実行は速いがコンパイルが面倒臭い

### インタプリタ方式
プログラムを逐一解釈して動作。

メリットは機械語に変換しないのでプラットフォームに依存しないこと

### 中間コード方式
中間コードに変換してから、中間コードを解釈して動作

中間コードを解釈するためにVirtualMachineが使われる。Java VMなど

プラットフォームに依存せず、実行が速い、2つのいいとこ取り

## CPUについて
複数のスレッドを同時に（正確には小さく区切って順次）実行している

待ち時間を減らすため、仕事を小さく切ってできることからどんどんやっていく

## メモリについて
### メソッドエリア/static area
static: 静的。プログラム開始時から終了時まで配置が固定（中身は変えられる）

クラスなどのコード情報、グローバル変数などが置いてある

### ヒープエリア
heap: 山ほど、たくさん

実行時に必要な情報を割り当てて一時的に置いておく

OOPだと、インスタンスが置いてある

### スタックエリア
stack: Last in First Out後から入れたものから取り出す。メソッドを読んで、1つ1つ上から処理していく感じ

1スレッドあたりひとつ用意されるメモリ領域。処理中のメソッドの引数やローカル変数等々が置かれている

## OOPのメモリ管理

クラス→メソッドエリア

インスタンス→ヒープエリア

処理中のデータ→スタックエリア

### Garbage Collector

スタックエリアとメソッドエリアから辿れなくなったインスタンスを削除する。

(例)なんらかのインスタンスの処理を実行しているとき：  
スタックエリアがインスタンスを参照しているので、インスタンスは削除されない。

(？疑問：メソッドエリアがインスタンスを参照しているとはどういうことか？)

Swiftの場合は、ARC(Automatic Reference Counting: 自動参照カウント)と呼ばれる一種のガベージコレクタ(以降GC)が実装されています。

ARCとJava等通常のGCとの違いは、

ARC(Swift)
* 常に参照をカウントしており、参照が0になった時に自動的に削除する  
  +)参照0になった直後に削除されるのでメモリのピーク使用量が小さい。  
  -)循環参照によるメモリリークが起きる
* コンパイラが処理を自動的にコードに埋め込む  
  +)メモリ解放のタイミングがわかる


GC(Java, Kotlin, C#)
* あるタイミングで、参照のないインスタンスをメモリ内から探し出して削除処理を行う  
  +)循環参照によるメモリリークが起きない  
  -)削除処理が重く、アプリが中断しうる
* Java VMなど実行環境側が提供する  
  -)メモリ解放のタイミングがコードで制御しにくい

(参考)

https://qiita.com/m__ike_/items/c021e280c5b2c659c59d

私はSwiftを初めて最初にぶつかったのが循環参照、弱参照などの概念でした。

ここで仕組みを知ることができ納得できました。