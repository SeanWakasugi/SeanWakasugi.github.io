---
title: "リーダブルコード9章感想"
date: 2022-08-22
categories: ["本まとめ"]
tags: ["リーダブルコード", "swift"]
---

## 9章: 変数と読みやすさ

変数を消す/減らす/わかりやすくして読みやすくしようという話です。

### 変数を削除する

いらない変数を消せば、読む人も覚える数が減って楽になります。

いらない変数とは、例えば制御フロー変数と呼んでいます。

例えば、関数の返り値にする予定の変数`res`を最初に定義しておいて、関数内の条件分岐で`res`に値を入れたり変更したりして、最終的に`res`を返り値として返すようにします。

```swift
func makeDebugLog() -> String? {
    var res: String?
    if isChecked {
        res = "checked"
        if isCorrect {
            res = "correct"
        } else {
            res = "not correct"
        }
        res = res + " result is:" + resultString
    } 
    return res
}
```

この変数が、制御フロー変数です。`res`があると、以下の問題点があります。

* `res`を順番に追っていかないと、今`res`に何が入っているか分からない。
* `res`の値を常に意識していなければいけない。

これを解決するには、早めに関数やループから抜けることです。

```swift
func makeDebugLog() -> String? {
    if isChecked {
        if isCorrect {
            return "checked and correct result is:" + resultString
        } else {
            return "checked and not correct result is:" + resultString
        }
    } 
    return nil
}
```

### 変数のスコープを縮める

変数を減らすというのは変数の記述を減らすことだけではありません。

変数の使える範囲（スコープ）を狭めることで、ある場所で使える変数を減らすことができます。

変数のスコープを縮めると、以下のメリットがあります。

* 1度に考えなくてもいい変数を減らせる
* 意図しない場所で呼んでしまう事故を減らせる

私はSwiftだと、以下を使い分けています。呼び名はおそらく間違っています。

##### メンバー変数
`internal let`, `let`
プロジェクト全体からアクセスしたい場合。

クラスごとに0〜2つくらいに絞りたいと思っています。

##### プライベートメンバー変数
`private let`
同一クラス内だけからアクセスできるようにしたい場合。

複数の関数が使うという理由の他に、クラスとして持つべき値かどうかを考えているつもりです。

##### 関数の引数、返り値で受け渡しする変数
2、3個の関数のみで使う場合。

##### 関数内の変数
1個の関数のみで使う場合。


### staticメソッドを使う

これは初めて知りました。

staticメソッドは、クラスをインスタンス化しなくても使えるメソッドなので、メソッドをstaticにすることでメンバー変数と関係ない処理であることが明示できます。

そのため、なるべくstaticなメソッドを作れば、クラスのメンバー変数のことを考えなくていいし、何のインスタンスを使っているかも考えなくて良くなる、ということです。

Swiftではstaticメソッドは同一クラス内でも毎回クラス名を書かないといけなかったりと、少し不便です。

そのため、うまく使っている人に出会うまで使わない予定です。


### 変数は一度だけ書き込む

Swiftでは`var`（可変の変数）にしておいて、一度しか書き込まないと`let`（変更不可な変数）にしろと軽く怒られます。

そのため、何となく`let`にする癖がついていましたが、この変数は一度だけ書き込むメリットはしっかり認識できていませんでした。

作者によると、変数を操作する場所が増えると現在の値を判断するのが難しくなるので、操作する箇所は減らすか1つにしたほうがいいとのことです。

私も同意です。

より`let`を多く使うための方法として、`let`でも、`var`のように書き込み1回目だけ値を変える使い方ができます。

オプショナルな`message`を定義して、条件によっては`message`に書き込むようなプログラムを作ります。

オプショナルな`message`は、1度しか書き込めない変数ですが、初期値は`nil`で書き込むと`String`型が入る（正確にはOptional型だが）という特徴があります。

そのため、`var`でなくても、`nil`だったら書き込み前、`String`が入っていれば書き込みされた後だと書き込みを調べることができます。

```swift
let message: String?

if hasNewMessage {
    message = inbox[0].message
}
```
