---
title: "Firebase多要素認証のメリットデメリット"
date: 2023-01-16
categories: ["Firebase"]
tags: ["Firebase"]
---
## Firebase多要素認証

* 今年の夏あたりに追加されたFirebase Authenticationの新機能
* メールアドレス+パスワードの通常の認証にプラスして、登録した携帯電話番号のSMSに確認コードを送って本人確認する
* (少ないユーザー数なら)無料！

## メリット/デメリット

メリット
1. 超簡単に実装できる
2. ユーザーの所在国問わずSMS認証ができる
3. 様々なプラットフォームのSDKが用意されている

デメリット
1. 電話番号認証をするが、1人1アカウントは保証されない
2. メールや電話番号を別DBと同期できない
3. 弱いパスワードを排除できない

## メリット: 超簡単に実装できる

* アプリ側はメソッドを1つ1つ呼んでいくだけで全部やってくれる
  * 例: 電話番号を引数にメソッドを呼ぶだけで、SMSに確認コードを送信まで自動でやってくれる
* アカウント管理が自動
  * パスワードを自分で管理しなくていい！
* SMS送信が自動
  * SMS送信、人間の操作であることの確認、確認コードの生成や、一致チェック等々ハードルの高そうな作業を全部Googleにやってもらえる

## メリット: ユーザーの所在国問わずSMS認証ができる

* 日本だけでなく、海外のユーザーもSMS認証ができる
  * 簡単にサービスのグローバル展開が可能
* +81 90 1234 5678のような国際電話番号で管理されるので、国番号を選択するUIなどが必要になる

## メリット: 様々なプラットフォームのSDKが用意されている

* 対応プラットフォームは、iOS、Android、Flutter、Web(JS)、C++、Unity
* 基本的に同じように実装できる


## デメリット: 電話番号認証をするが、1人1アカウントは保証されない

* 電話番号が既存ユーザーと同じであるかのチェックはされない
  * 多要素認証を1人1アカウントまでに制限する手段としてよく使われるが、その用途には使用できない
* 一応電話番号登録時にadmin sdkで同一の電話番号が登録されていないかチェックすることならできるはず……。

## デメリット: メールや電話番号を別DBと同期できない

* メール、電話番号の変更タイミングに通知を受け取ったり、そのタイミングで別DBを書かせたりすることができない
* 想定外のタイミングでメール、電話番号が変更されることがある
  * メールの変更は、確認メールのリンクを押下したときに確定される、押さないと変更されない
  * 電話番号の登録は登録確認メールのリンクから解除できてしまう
* メールと電話番号はFirebase Authのみで管理するのが無難

## デメリット: 弱いパスワードを排除できない

* Firebase Auth標準のパスワード規則は**6文字以上**のみ
  * "123456"も"aaaaaa"も登録できる
  * なぜか"ああああああ"も"รหัสผ่าน"も登録できる
* 新規登録の時にパスワードのバリデーション→抜け道あり
  * 「パスワードを忘れた」メールアドレスにパスワードリセットのリンクが送信されて、ブラウザ上で新パスワードが設定できてしまうので、バリデーションをすり抜けたパスワードが設定できる
* パスワード規則を設定できるようになりそう……?
  https://cloud.google.com/identity-platform/docs/password-policy

## まとめ

簡単に多要素認証を実装できるが、カスタマイズの自由度は低い

1. 電話番号認証をするが、1人1アカウントは保証されない
   * 複数アカウント防止の目的に使用しない
2. メールや電話番号を別DBと同期できない
   * Firebase Authのみで管理する
3. 弱いパスワードを排除できない
   * 新規登録時にパスワードのバリデーションをする。
   * 「パスワードを忘れた」から設定された弱い&変なパスワードも許容するか、ユーザーに促して再設定させる